<?php

include dirname(__FILE__).'/../../bootstrap/functional.php';

$test = new opTestFunctional(new sfBrowser());

include dirname(__FILE__).'/../../bootstrap/database.php';

$test->setCulture('en');

Doctrine::getTable('SnsConfig')->set('op_diary_plugin_use_open_diary', '0');

$test->info('isSecure Test')
  ->get('/diary')
  ->isForwardedTo('member', 'login')

  ->get('/diary/list')
  ->isForwardedTo('member', 'login')

  ->get('/diary/search', array('keyword' => 'hoge'))
  ->isForwardedTo('member', 'login')

  ->get('/diary/3')
  ->isForwardedTo('member', 'login')

  ->get('/diary/listMember/5')
  ->isForwardedTo('member', 'login')

  ->get('/diary/listMember/5/2009/6')
  ->isForwardedTo('member', 'login')

  ->get('/diary/listMember/5/2009/6/1')
  ->isForwardedTo('member', 'login')
;

Doctrine::getTable('SnsConfig')->set('op_diary_plugin_use_open_diary', '1');
